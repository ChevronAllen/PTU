<rolltemplate class="sheet-rolltemplate-PTU_attack">
    <table>
        <tr>
            <th colspan="2">{{name}} uses {{attack}}</th>
        </tr>
        <tr>
            <td style="text-align:right"><strong>Frequency</strong> </td>
            <td> {{frequency}} </td>
        </tr>
        <tr>
            <td style="text-align:right"><strong> Range</strong></td>
            <td>{{range}}</td>
        </tr>
        <tr>
            <td style="text-align:right"><strong>Type</strong></td>
            <td>{{type}} <strong>|</strong> {{category}} </td>
        </tr>
        <tr>
            <td style="text-align:right;"><strong>AC</strong></td>
            <td >{{ac}} </td>
        </tr>
        <tr>
            <td style="text-align:right;"><strong>Accuracy</strong></td>
            <td >{{accuracy}} </td>
        </tr>
        <tr>
            <td style="text-align:right;"><strong>Crits On</strong></td>
            <td ><strong>{{crit_range}}+</strong></td>
        </tr>
        <tr>
            <td style="text-align:right;"><strong>DB</strong></td>
            <td >{{db}}</td>
        </tr>
        <tr>
            <td style="text-align:right;"><strong>Damage</strong></td>
            <td >{{damage}} </td>
        </tr>
        {{#rollWasCrit() accuracy}}
        <tr>
            <td style="text-align:right;"><strong>Critical</strong></td>
            <td >{{crit_damage}} {{type}}</td>
        </tr>.sheet-whisper span
        {{/rollWasCrit() accuracy}}
        {{#effect}}
        <tr>
            <td style="text-align:right"><strong>Contest Type</strong></td>
            <td>{{contest_type}}</td>
        </tr>
        <tr>
            <td style="text-align:right"><strong>Contest Effects</strong></td>
            <td>{{contest_effects}}</td>
        </tr>
        <tr>
            
            <td colspan="2" style="white-space: pre-line;padding:5px;">{{effect}}</td>
        </tr>
        {{/effect}}
    </table>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-PTU">
    <table>
        <tr>
            <th colspan="2">{{name}}</th>
        </tr>
        {{#allprops() name effect}}
        <tr>
            <td><strong>{{key}}</strong></td>
            <td style="white-space: pre-line;">{{value}}</td>
        </tr>
        {{/allprops() name effect}}
        {{#effect}}
        <tr>
            
            <td colspan="2" style="white-space: pre-line;text-align:left">{{effect}}</td>
        </tr>
        {{/effect}}
    </table>
</rolltemplate>


<input type="hidden" class="sheet-trainerSwap" name="attr_isTrainer" />

<img src="https://raw.githubusercontent.com/ChevronAllen/PTU/master/Logo.png" style="display:block;margin:0 auto;width:100px">

<div>
    <div class="sheet-creature-swap-wrapper">
        <input type="checkbox" name="attr_isTrainer" value="1">
        <span>Pokemon</span>
        <span>Trainer</span>
    </div>
</div>



<!---------------------------------- 
    Character Info
---------------------------------------->

<div class="sheet-character-info">
    <input type="hidden" class="sheet-trainerSwap" name="attr_isTrainer" value="1"/>
    
    <div class="sheet-row sheet-trainer-only">
        <div class="sheet-field" style="width:250px">
            <input type="text" name="attr_character_name" />
            <span>Name</span>
        </div>
        <div class="sheet-field" style="width:70px">
            <input type="number" name="attr_character_age" />
            <span>Age</span>
        </div>
        <div class="sheet-field" style="width:100px">
            <input type="text" name="attr_character_gender" />
            <span>Gender</span>
        </div>
        <div style="display:inline-block">
            <img src="https://raw.githubusercontent.com/ChevronAllen/PTU/master/PokeDollar.png" style="vertical-align: super;" />
        </div>
        <div class="sheet-field" style="width:100px">
            <input type="number" name="attr_character_money" />
            <span>Money</span>
        </div>
    </div>
    <div class="sheet-row sheet-pokemon-only">
        <div class="sheet-field" style="width:250px">
            <input type="text" name="attr_character_name" />
            <span>Nickname</span>
        </div>
        <div class="sheet-field" style="">
            <input type="text" name="attr_character_species" />
            <span>Species</span>
        </div>
        <div class="sheet-field" style="width:100px">
            <input type="text" name="attr_character_gender" />
            <span>Gender</span>
        </div>
    </div>
    <div class="sheet-row sheet-pokemon-only" >
        <div class="sheet-field" style="width:120px">
            <select name="attr_character_nature">
                <option>-</option>
                <option>Adamant</option>
            </select>
            <span>Nature</span>
        </div>
        <strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</strong>
        <div class="sheet-field" style="width:120px">
            <span class="sheet-field" name="attr_character_likes"></span>
            <span>Likes</span>
        </div>
        <div class="sheet-field" style="width:120px">
            <span class="sheet-field" name="attr_character_dislikes"></span>
            <span>Dislikes</span>
        </div>
    </div>
    
    <div class="sheet-row">
        <div class="sheet-field" style="">
            <input type="text" name="attr_character_height" />
            <span>Height</span>
        </div>
        <div class="sheet-field" style="">
            <input type="text" name="attr_character_weight" />
            <span>Weight</span>
        </div>
    </div>
    <div class="sheet-row sheet-trainer-only">
        <div class="sheet-background">
            <input type="checkbox" class="sheet-hide-swap" checked/><span></span>
            <div class="sheet-field" style="width:400px">
                <input type="text" name="attr_background_name" />
                <span>Background</span>
            </div>
            <div class="sheet-hide-swap-a">
                <div class="sheet-row">
                    <div class="sheet-field" style="width:160px">
                        <input type="text" name="attr_background_adept" />
                        <span>Adept Skill</span>
                    </div>
                    <div class="sheet-field" style="width:160px">
                        <input type="text" name="attr_background_novice" />
                        <span>Novice Skill</span>
                    </div>
                </div>
                
                <div class="sheet-row">
                    <div class="sheet-field" style="width:100%">
                        <input type="text" name="attr_background_pathetic" />
                        <span>Pathetic Skills</span>
                    </div>
                </div>
                <textarea class="" name="attr_background_descr" style="height: 60px;"></textarea>
            </div>
            <div class="sheet-hide-swap-b">
                <span class="sheet-background-adept">
                    <span name="attr_background_adept"></span>
                </span>
                <span class="sheet-background-novice">
                    <span name="attr_background_novice"></span>
                </span>
                <span class="sheet-background-pathetic">
                    <span name="attr_background_pathetic"></span>
                </span>
            </div>
            
        </div>
    </div>
        
</div>

<div class="sheet-wrapper">
    <!-- Tab Container -->
    <div class="sheet-tab-container">
        <div class="sheet-tab">
            <input type="radio" name="attr_tab" value="0" checked="true" />
            <span>General</span>
        </div>
        <div class="sheet-tab">
            <input type="radio" name="attr_tab" value="1" />
            <span>Skills</span>
        </div>
        <div class="sheet-tab"> 
            <input type="radio" name="attr_tab" value="2" />
            <span>Moves</span>
        </div>
        <div class="sheet-tab">
            <input type="radio" name="attr_tab" value="3" />
            <span>Edges & Features</span>
        </div>
        <div class="sheet-tab">
            <input type="radio" name="attr_tab" value="4" />
            <span >Inventory</span>
        </div>
        <div class="sheet-whisper">
            <input type="radio" name="attr_whisper" value="/w gm" checked/>
            <span style="left:0px">To GM</span>
            <input type="radio" name="attr_whisper" value=" " />
            <span style="right:0px">Public</span>
        </div>

    </div>
    
    <!-- Sheet Body-->
    <div class="sheet-body-container">
        <input type="hidden" name="attr_tab" class="sheet-tab-swap" value="1" />
        
        <!----------------------------------------
            (0) General Info
        ----------------------------------------->
        <div class="sheet-page-general">
            <div class="sheet-left">
                <div class="sheet-stats">
                    <table>
                        <tbody>
                            <tr>
                                <th colspan="6">Stats</th>
                            </tr>
                            <tr>
                                <th></th>
                                <th>Base</th>
                                <th>Allocated</th>
                                <th>Bonus</th>
                                <th>Combat</th>
                                <th>Adjusted</th>
                            </tr>
                            <tr>
                                <td><strong>HP</strong></td>
                                <td><input type="number" value="10" min="0"/></td>
                                <td><input type="number" value="0" min="0"/></td>
                                <td><input type="number" value="0" /></td>
                                <td></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                <td><strong>Attack</strong></td>
                                <td><input type="number" value="5" min="0"/></td>
                                <td><input type="number" value="0" min="0"/></td>
                                <td><input type="number" value="0" /></td>
                                <td><input type="number" value="0" min="-6" max="6"/></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                <td><strong>Defense</strong></td>
                                <td><input type="number" value="5" min="0"/></td>
                                <td><input type="number" value="0" min="0"/></td>
                                <td><input type="number" value="0" /></td>
                                <td><input type="number" value="0" min="-6" max="6"/></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                <td><strong>Sp.Attack</strong></td>
                                <td><input type="number" value="5" min="0"/></td>
                                <td><input type="number" value="0" min="0"/></td>
                                <td><input type="number" value="0" /></td>
                                <td><input type="number" value="0" min="-6" max="6"/></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                <td><strong>Sp.Defense</strong></td>
                                <td><input type="number" value="5" min="0"/></td>
                                <td><input type="number" value="0" min="0"/></td>
                                <td><input type="number" value="0" /></td>
                                <td><input type="number" value="0" min="-6" max="6"/></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                <td><strong>Speed</strong></td>
                                <td><input type="number" value="5" min="0"/></td>
                                <td><input type="number" value="0" min="0"/></td>
                                <td><input type="number" value="0" /></td>
                                <td><input type="number" value="0" min="-6" max="6"/></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                <td colspan="3"><strong>Initiative</strong></td>
                                <td><input type="number" value="0" /></td>
                                <td></td>
                                <td><button type="roll" name="" value=""></button></span></td>
                            </tr>
                            <tr>
                                <th colspan="6">Bonuses</th>
                            </tr>
                            <tr>
                                <td colspan="3"><strong>Accuracy Bonus</strong></td>
                                <td><input type="number" value="0" /></td>
                                <td><input type="number" value="0" min="-6" max="6"/></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                <td colspan="3"><strong>Evasion Bonus</strong></td>
                                <td><input type="number" value="0" /></td>
                                <td><input type="number" value="0" min="-6" max="6"/></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                <td colspan="3"><strong>Damage Bonus</strong></td>
                                <td><input type="number" value="0" /></td>
                                <td></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                <td colspan="3"><strong>Damage Resistance</strong></td>
                                <td><input type="number" value="0" /></td>
                                <td></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                <th colspan="6">Evasions</th>
                            </tr>
                            <tr>
                                <td colspan="3"><strong>Physical Evasion</strong></td>
                                <td><input type="number" value="0" /></td>
                                <td></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                <td colspan="3"><strong>Special Evasion</strong></td>
                                <td><input type="number" value="0" /></td>
                                <td></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                <td colspan="3"><strong>Speed Evasion</strong></td>
                                <td><input type="number" value="0" /></td>
                                <td></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                <th colspan="6">Capabilities</th>
                            </tr>
                            <tr>
                                <td colspan="3"><strong>Overland</strong></td>
                                <td><input type="number" value="0" /></td>
                                <td></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                <td colspan="3"><strong>Swim</strong></td>
                                <td><input type="number" value="0" /></td>
                                <td></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                <td colspan="3"><strong>Power</strong></td>
                                <td><input type="number" value="0" /></td>
                                <td></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                <td colspan="3"><strong>Thrown</strong></td>
                                <td><input type="number" value="0" /></td>
                                <td></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                <td colspan="3"><strong>Jump (High)</strong></td>
                                <td><input type="number" value="0" /></td>
                                <td></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                <td colspan="3"><strong>Jump (Long)</strong></td>
                                <td><input type="number" value="0" /></td>
                                <td></td>
                                <td><span class="sheet-readonly-field" name=""></span></td>
                            </tr>
                            <tr>
                                    <th colspan="6">Custom Capabilities</th>
                            </tr>
                        </tbody>
                    </table>
                    <div>
                        <fieldset class="repeating_capabilities">
                            <div class="sheet-custom-capability">
                                <input type="text" name="" />
                                <input type="number" name="" />
                            </div>
                        </fieldset>
                    </div>
                </div>
                
            </div>
            
            <div class="sheet-right">
                <div class="sheet-status">
                    
                    <table>
                        <tbody>
                            <tr>
                                <th colspan="2">Status</th>
                            </tr>
                            <tr>
                                <td>
                                    <label>Level</label>
                                </td>
                                <td>
                                    <div class="sheet-field" style="width:70px">
                                        <input type="number" name="" />
                                        <span>Level</span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label>EXP</label>
                                </td>
                                <td>
                                    <div class="sheet-field-simple" style="width:70px">
                                        <input type="number" name="" />
                                    </div>
                                    <strong>&nbsp;/&nbsp;</strong>
                                    <div class="sheet-field-simple" style="width:70px">
                                        <input type="number" name="" />
                                    </div>
                                </td>
                            </tr>
                            
                            <tr>
                                <td>
                                    <label>AP</label>
                                </td>
                                <td>
                                    
                                    <div class="sheet-field-simple" style="width:70px">
                                        <input type="number" name="" />
                                    </div>
                                    <strong>&nbsp;/&nbsp;</strong>
                                    <div class="sheet-field-simple" style="width:70px">
                                        <input type="number" name="" disabled/>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label>Temp Hit Points</label>
                                </td>
                                <td>
                                    
                                    
                                    <div class="sheet-field-simple" style="width:70px">
                                        <input type="number" name="" />
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label>Hit Points</label>
                                </td>
                                <td>
                                    
                                    <div class="sheet-field-simple" style="width:70px">
                                        <input type="number" name="" />
                                    </div>
                                    <strong>&nbsp;/&nbsp;</strong>
                                    <div class="sheet-field-simple" style="width:70px">
                                        <input type="number" name="" />
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label>Injuries</label>
                                </td>
                                <td>
                                    
                                    <div class="sheet-field-simple" style="width:70px">
                                        <input type="number" name="" />
                                    </div>
                                    <strong>&nbsp;/&nbsp;</strong>
                                    <div class="sheet-field-simple" style="width:70px">
                                        <input type="number" value="10"  disabled/>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <table class="sheet-HP-Markers">
                        <tbody>
                            <tr>
                                <th colspan="4">HP Markers</th>
                            </tr>
                            <tr>
                                <td><label>75%</label></td>
                                <td>
                                    <div class="sheet-field-simple" style="width:70px">
                                        <span class="sheet-field"></span>
                                        
                                    </div>
                                </td>
                                <td><label>1/6</label></td>
                                <td>
                                    <div class="sheet-field-simple" style="width:70px">
                                        <span class="sheet-field"></span>
                                        
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td><label>50%</label></td>
                                <td>
                                    <div class="sheet-field-simple" style="width:70px">
                                        <span class="sheet-field"></span>
                                        
                                    </div>
                                </td>
                                <td><label>1/8</label></td>
                                <td>
                                    <div class="sheet-field-simple" style="width:70px">
                                        <span class="sheet-field"></span>
                                        
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td><label>25%</label></td>
                                <td>
                                    <div class="sheet-field-simple" style="width:70px">
                                        <span class="sheet-field"></span>
                                        
                                    </div>
                                </td>
                                <td><label style="font-size: 1.1em;" >1/10 (tick)</label></td>
                                <td>
                                    <div class="sheet-field-simple" style="width:70px">
                                        <span class="sheet-field"></span>
                                        
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td><label>1/3</label></td>
                                <td>
                                    <div class="sheet-field-simple" style="width:70px">
                                        <span class="sheet-field"></span>
                                        
                                    </div>
                                </td>
                                <td><label>1/12</label></td>
                                <td>
                                    <div class="sheet-field-simple" style="width:70px">
                                        <span class="sheet-field"></span>
                                        
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <table class="sheet-conditions">
                        <tbody>
                            <tbody>
                                <tr>
                                    <th colspan="2">Status Conditions</th>
                                </tr>
                                <tr>
                                    <th colspan="2">Persistent Statuses</th>
                                </tr>
                                <tr>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Burned</span>
                                    </td>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Frozen</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Paralysis</span>
                                    </td>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Poisoned</span>
                                    </td>
                                </tr>
                                <tr>
                                    <th colspan="2">Volatile Conditions</th>
                                </tr>
                                <tr>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Bad Sleep</span>
                                    </td>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Confused</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Cursed</span>
                                    </td>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Disabled</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Rage</span>
                                    </td>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Flinch</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Infatuation</span>
                                    </td>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Sleep</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Suppressed</span>
                                    </td>
                                    <td class="sheet-condition-item">

                                    </td>
                                </tr>
                                <tr>
                                    <th colspan="2">Other Statuses</th>
                                </tr>
                                <tr>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Fainted</span>
                                    </td>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Blindness</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Total Blindness</span>
                                    </td>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Slowed</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Stuck</span>
                                    </td>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Trapped</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Tripped</span>
                                    </td>
                                    <td class="sheet-condition-item">
                                        <input type="checkbox" name=""/>
                                        <span title='#000' >Vulnerable</span>
                                    </td>
                                </tr>
                                <tr>
                                    <th colspan="2">Custom Statuses</th>
                                </tr>
                                
                            </tbody>
                        </tbody>
                    </table>
                    
                    <div>
                        <fieldset class="repeating_status">
                            <div class="sheet-custom-status">
                                <input type="checkbox" name="attr_status" />
                                <input type="text" name="attr_status_name" />
                            </div>
                        </fieldset>    
                    </div>
                    
                </div>
                
            </div>
            
        </div>
        
        
        <!----------------------------------------
            (1) Skills
        ----------------------------------------->
        <div class="sheet-page-skills">
            <div>
                <table class="sheet-skills">
                    <tbody>
                        <tr>
                            <th></th>
                            <th width="250px"> Rank</th>
                            
                            <th> Bonus</th>
                            <th></th>
                        </tr>
                        <tr>
                            <th colspan="4">Body Skills</th>
                        </tr>
                        <tr class="sheet-skill-body">
                            <td><label>Acrobatics</label></td>
                            <td>
                                <div class="sheet-field-simple">
                                    <span name="attr_acrobatics_rank"></span>
                                </div>
                                <input type="number" name="attr_acrobatics" value="2" min="0"/><label>&nbsp;&nbsp;d6</label>
                            </td>
                            
                            <td><input type="number" name="attr_acrobatics_bonus" value="0" /></td>                                               
                            <td>
                                <button type="roll" 
                                value="@{whisper} &{template:PTU} {{name=@{character_name}'s Acrobatics }} {{rank=@{acrobatics_rank} }} {{roll=[[@{acrobatics}d6 + @{acrobatics_bonus}]] }}"></button>
                            </td>
                        </tr>
                        <tr class="sheet-skill-body">
                            <td><label>Athletics</label></td>
                            <td>
                                <div class="sheet-field-simple">
                                    <span name="attr_athletics_rank"></span>
                                </div>
                                <input type="number" name="attr_athletics" value="2" min="0"/><label>&nbsp;&nbsp;d6</label>
                            </td>
                            
                            <td><input type="number" name="attr_athletics_bonus" value="0" /></td>                                               
                            <td>
                                <button type="roll" 
                                value="@{whisper} &{template:PTU} {{name=@{character_name}'s Athletics }} {{rank=@{athletics_rank} }} {{roll=[[@{athletics}d6 + @{athletics_bonus}]] }}"></button>
                            </td>
                        </tr>
                        <tr class="sheet-skill-body">
                            <td><label>Combat</label></td>
                            <td>
                                <div class="sheet-field-simple">
                                    <span name="attr_combat_rank"></span>
                                </div>
                                <input type="number" name="attr_combat" value="2" min="0"/><label>&nbsp;&nbsp;d6</label>
                            </td>
                            
                            <td><input type="number" name="attr_combat_bonus" value="0" /></td>                                               
                            <td>
                                <button type="roll" 
                                value="@{whisper} &{template:PTU} {{name=@{character_name}'s Combat }} {{rank=@{combat_rank} }} {{roll=[[@{combat}d6 + @{combat_bonus}]] }}"></button>
                            </td>
                        </tr>
                        <tr class="sheet-skill-body">
                            <td><label>Intimidate</label></td>
                            <td>
                                <div class="sheet-field-simple">
                                    <span name="attr_intimidate_rank"></span>
                                </div>
                                <input type="number" name="attr_intimidate" value="2" min="0"/><label>&nbsp;&nbsp;d6</label>
                            </td>
                            
                            <td><input type="number" name="attr_intimidate_bonus" value="0" /></td>                                               
                            <td>
                                <button type="roll" 
                                value="@{whisper} &{template:PTU} {{name=@{character_name}'s Intimidate }} {{rank=@{intimidate_rank} }} {{roll=[[@{intimidate}d6 + @{intimidate_bonus}]] }}"></button>
                            </td>
                        </tr>
                        <tr class="sheet-skill-body">
                            <td><label>Stealth</label></td>
                            <td>
                                <div class="sheet-field-simple">
                                    <span name="attr_stealth_rank"></span>
                                </div>
                                <input type="number" name="attr_stealth" value="2" min="0"/><label>&nbsp;&nbsp;d6</label>
                            </td>
                            
                            <td><input type="number" name="attr_stealth_bonus" value="0" /></td>                                               
                            <td>
                                <button type="roll" 
                                value="@{whisper} &{template:PTU} {{name=@{character_name}'s Stealth }} {{rank=@{stealth_rank} }} {{roll=[[@{stealth}d6 + @{stealth_bonus}]] }}"></button>
                            </td>
                        </tr>
                        <tr class="sheet-skill-body">
                            <td><label>Survival</label></td>
                            <td>
                                <div class="sheet-field-simple">
                                    <span name="attr_survival_rank"></span>
                                </div>
                                <input type="number" name="attr_survival" value="2" min="0"/><label>&nbsp;&nbsp;d6</label>
                            </td>
                            
                            <td><input type="number" name="attr_survival_bonus" value="0" /></td>                                               
                            <td>
                                <button type="roll" 
                                value="@{whisper} &{template:PTU} {{name=@{character_name}'s Survival }} {{rank=@{survival_rank} }} {{roll=[[@{survival}d6 + @{survival_bonus}]] }}"></button>
                            </td>
                        </tr>
                        
                        
                        <tr>
                            <th colspan="5">Mind Skills</th>
                        </tr>
                        
                        
                        <tr class="sheet-skill-mind">
                            <td><label>General Education</label></td>
                            <td>
                                <div class="sheet-field-simple">
                                    <span name="attr_general_edu_rank"></span>
                                </div>
                                <input type="number" name="attr_general_edu" value="2" min="0"/><label>&nbsp;&nbsp;d6</label>
                            </td>
                            
                            <td><input type="number" name="attr_general_edu_bonus" value="0" /></td>                                               
                            <td>
                                <button type="roll" 
                                value="@{whisper} &{template:PTU} {{name=@{character_name}'s General Education }} {{rank=@{general_edu_rank} }} {{roll=[[@{general_edu}d6 + @{general_edu_bonus}]] }}"></button>
                            </td>
                        </tr>
                        <tr class="sheet-skill-mind">
                            <td><label>Medicine Education</label></td>
                            <td>
                                <div class="sheet-field-simple">
                                    <span name="attr_medicine_edu_rank"></span>
                                </div>
                                <input type="number" name="attr_medicine_edu" value="2" min="0"/><label>&nbsp;&nbsp;d6</label>
                            </td>
                            
                            <td><input type="number" name="attr_medicine_edu_bonus" value="0" /></td>                                               
                            <td>
                                <button type="roll" 
                                value="@{whisper} &{template:PTU} {{name=@{character_name}'s Medicine Education }} {{rank=@{medicine_edu_rank} }} {{roll=[[@{medicine_edu}d6 + @{medicine_edu_bonus}]] }}"></button>
                            </td>
                        </tr>
                        <tr class="sheet-skill-mind">
                            <td><label>Occult Education</label></td>
                            <td>
                                <div class="sheet-field-simple">
                                    <span name="attr_occult_edu_rank"></span>
                                </div>
                                <input type="number" name="attr_occult_edu" value="2" min="0"/><label>&nbsp;&nbsp;d6</label>
                            </td>
                            
                            <td><input type="number" name="attr_occult_edu_bonus" value="0" /></td>                                               
                            <td>
                                <button type="roll" 
                                value="@{whisper} &{template:PTU} {{name=@{character_name}'s Occult Education }} {{rank=@{occult_edu_rank} }} {{roll=[[@{occult_edu}d6 + @{occult_edu_bonus}]] }}"></button>
                            </td>
                        </tr>
                        <tr class="sheet-skill-mind">
                            <td><label>Pokemon Education</label></td>
                            <td>
                                <div class="sheet-field-simple">
                                    <span name="attr_pokemon_edu_rank"></span>
                                </div>
                                <input type="number" name="attr_pokemon_edu" value="2" min="0"/><label>&nbsp;&nbsp;d6</label>
                            </td>
                            
                            <td><input type="number" name="attr_pokemon_edu_bonus" value="0" /></td>                                               
                            <td>
                                <button type="roll" 
                                value="@{whisper} &{template:PTU} {{name=@{character_name}'s Pokemon Education }} {{rank=@{pokemon_edu_rank} }} {{roll=[[@{pokemon_edu}d6 + @{pokemon_edu_bonus}]] }}"></button>
                            </td>
                        </tr>
                        <tr class="sheet-skill-mind">
                            <td><label>Technology Education</label></td>
                            <td>
                                <div class="sheet-field-simple">
                                    <span name="attr_pokemon_edu_rank"></span>
                                </div>
                                <input type="number" name="attr_pokemon_edu" value="2" min="0"/><label>&nbsp;&nbsp;d6</label>
                            </td>
                            
                            <td><input type="number" name="attr_pokemon_edu_bonus" value="0" /></td>                                               
                            <td>
                                <button type="roll" 
                                value="@{whisper} &{template:PTU} {{name=@{character_name}'s Technology Education }} {{rank=@{technology_edu_rank} }} {{roll=[[@{technology_edu}d6 + @{technology_edu_bonus}]] }}"></button>
                            </td>
                        </tr>
                        <tr class="sheet-skill-mind">
                            <td><label>Guile</label></td>
                            <td>
                                <div class="sheet-field-simple">
                                    <span name="attr_guile_rank"></span>
                                </div>
                                <input type="number" name="attr_guile" value="2" min="0"/><label>&nbsp;&nbsp;d6</label>
                            </td>
                            
                            <td><input type="number" name="attr_guile_bonus" value="0" /></td>                                               
                            <td>
                                <button type="roll" 
                                value="@{whisper} &{template:PTU} {{name=@{character_name}'s Guile }} {{rank=@{guile_rank} }} {{roll=[[@{guile}d6 + @{guile_bonus}]] }}"></button>
                            </td>
                        </tr>
                        <tr class="sheet-skill-mind">
                            <td><label>Perception</label></td>
                            <td>
                                <div class="sheet-field-simple">
                                    <span name="attr_perception_rank"></span>
                                </div>
                                <input type="number" name="attr_perception" value="2" min="0"/><label>&nbsp;&nbsp;d6</label>
                            </td>
                            
                            <td><input type="number" name="attr_perception_bonus" value="0" /></td>                                               
                            <td>
                                <button type="roll" 
                                value="@{whisper} &{template:PTU} {{name=@{character_name}'s Perception }} {{rank=@{perception_rank} }} {{roll=[[@{perception}d6 + @{perception_bonus}]] }}"></button>
                            </td>
                        </tr>
                        
                        
                        
                        
                        <tr>
                            <th colspan="5">Spirit Skills</th>
                        </tr>
                        
                        
                        <tr class="sheet-skill-spirit">
                            <td><label>Charm</label></td>
                            <td>
                                <div class="sheet-field-simple">
                                    <span name="attr_charm_rank"></span>
                                </div>
                                <input type="number" name="attr_charm" value="2" min="0"/><label>&nbsp;&nbsp;d6</label>
                            </td>
                            
                            <td><input type="number" name="attr_charm_bonus" value="0" /></td>                                               
                            <td>
                                <button type="roll" 
                                value="@{whisper} &{template:PTU} {{name=@{character_name}'s Charm }} {{rank=@{charm_rank} }} {{roll=[[@{charm}d6 + @{charm_bonus}]] }}"></button>
                            </td>
                        </tr>
                        <tr class="sheet-skill-spirit">
                            <td><label>Command</label></td>
                            <td>
                                <div class="sheet-field-simple">
                                    <span name="attr_command_rank"></span>
                                </div>
                                <input type="number" name="attr_command" value="2" min="0"/><label>&nbsp;&nbsp;d6</label>
                            </td>
                            
                            <td><input type="number" name="attr_command_bonus" value="0" /></td>                                               
                            <td>
                                <button type="roll" 
                                value="@{whisper} &{template:PTU} {{name=@{character_name}'s Command }} {{rank=@{command_rank} }} {{roll=[[@{command}d6 + @{command_bonus}]] }}"></button>
                            </td>
                        </tr>
                        <tr class="sheet-skill-spirit">
                            <td><label>Focus</label></td>
                            <td>
                                <div class="sheet-field-simple">
                                    <span name="attr_focus_rank"></span>
                                </div>
                                <input type="number" name="attr_focus" value="2" min="0"/><label>&nbsp;&nbsp;d6</label>
                            </td>
                            
                            <td><input type="number" name="attr_focus_bonus" value="0" /></td>                                               
                            <td>
                                <button type="roll" 
                                value="@{whisper} &{template:PTU} {{name=@{character_name}'s Focus }} {{rank=@{focus_rank} }} {{roll=[[@{focus}d6 + @{focus_bonus}]] }}"></button>
                            </td>
                        </tr>
                        <tr class="sheet-skill-spirit">
                            <td><label>Intuition</label></td>
                            <td>
                                <div class="sheet-field-simple">
                                    <span name="attr_intuition_rank"></span>
                                </div>
                                <input type="number" name="attr_intuition" value="2" min="0"/><label>&nbsp;&nbsp;d6</label>
                            </td>
                            
                            <td><input type="number" name="attr_intuition_bonus" value="0" /></td>                                               
                            <td>
                                <button type="roll" 
                                value="@{whisper} &{template:PTU} {{name=@{character_name}'s Intuition }} {{rank=@{intuition_rank} }} {{roll=[[@{intuition}d6 + @{intuition_bonus}]] }}"></button>
                            </td>
                        </tr>
                        
                        
                        
                    </tbody>
                </table>
                
                <fieldset class="repeating_skills">
                    
                    <div class="sheet-skill_item">
                        <input type="text" name="attr_skill_name" />
                        <div class="sheet-field-simple" style="width:150px;text-align:center">
                            <span  name="attr_skill_rank">Untrained</span>
                        </div>
                        <input type="number" name="attr_skill" min="0" value="2" />
                        <label style=""><pre> d6 + </pre></label>
                        <input type="number" name="attr_skill_bonus" value="0" />
                    </div>
                </fieldset>
                
            </div>
        </div>
        
    </div>
    
</div>

<!--
    convert DB to Damage Damage roll
-->
<script type="text/worker">
    
    
    function set_damage_roll(dieCount,dieType,modifier){
        
        var n = parseInt(dieCount, 10)||0;
        var d = parseInt(dieType,  10)||0;
        var m = parseInt(modifier, 10)||0;

        var roll = n + "d" +  d + (m >= 0 ? (" + " + Math.abs(m) ):(" - " + Math.abs(m) )) ;
        return roll;
    }
    function convert_db(db){
        var n , d, m;
        
        // Number of Dice
        if(db < 6){ n = 1;}
        else if(db<10){ n = 2;}
        else if(db<13){ n = 3;}
        else if(db<16){ n = 4;}
        else if(db<18){ n = 5;}
        else if(db<26){ n = 6;}
        else if(db<27){ n = 7;}
        else { n = 8;}
        
        // Die Type
        if(db < 4 || (db>5 && db<8) ){ d = 6;}
        else if((db>3 && db<6) || db==8 || db===10){ d = 8;}
        else if(db==9 || db==11 || (db>12 && db<17) ){ d = 10;}
        else { d = 12;}
        
        // Modifier
        if(db < 2){ m = 1;}
        else if(db<3){ m = 3;}
        else if(db<4){ m = 5;}
        else if(db<5){ m = 6;}
        else if(db<7){ m = 8;}
        else if(db<14){ m = 10;}
        else if(db<15){ m = 15;}
        else if(db<17){ m = 20;}
        else if(db<19){ m = 25;}
        else if(db<20){ m = 30;}
        else if(db<21){ m = 35;}
        else if(db<22){ m = 40;}
        else if(db<23){ m = 45;}
        else if(db<24){ m = 50;}
        else if(db<25){ m = 55;}
        else if(db<26){ m = 60;}
        else if(db<27){ m = 65;}
        else if(db<28){ m = 70;}
        else { m = 80;}
        
        return {dieCount: n, dieType: d, mod:m};
    }
    
    //Set damage roll
    on("change:repeating_moves:move_damage_dicecount change:repeating_moves:move_damage_dice change:repeating_moves:move_damage_mod", function() {
       //Do something here
       // eventInfo.sourceAttribute is the full name (including repeating ID) of the attribute 
       // that originally triggered this event, 
       // however the entire string will have been translated into lowercase and thus might not be 
       // suitable for being fed directly
       // into getAttrs() or other uses without being devandalized first.
        console.log("Entered Worker Script");
        
        getAttrs([
          "repeating_moves_move_damage_dicecount",
          "repeating_moves_move_damage_dice",
          "repeating_moves_move_damage_mod"
        ], function(values) {
            var n = parseInt(values["repeating_moves_move_damage_dicecount"], 10)||0;
            var d = parseInt(values["repeating_moves_move_damage_dice"], 10)||0;
            var m = parseInt(values["repeating_moves_move_damage_mod"], 10)||0;

            var roll = set_damage_roll(n,d,m);
            
            setAttrs({
                "repeating_moves_move_damage_roll": roll
            });
            
        });
    });
    
    // Calculate damage base
    on("change:repeating_moves:move_damage_base",function(eventInfo ){
        var db = parseInt(eventInfo.newValue,10)||1
        var n , d, m;
        
        var db_roll = convert_db(db);

        var roll = set_damage_roll(db_roll.dieCount,db_roll.dieType,db_roll.mod);
        
        setAttrs({
            "repeating_moves_move_damage_roll": roll
        });
        setAttrs({
            "repeating_moves_move_damage_dicecount": n
        });
        setAttrs({
            "repeating_moves_move_damage_dice": d
        });
        setAttrs({
            "repeating_moves_move_damage_mod": m
        });
        
    });
    
    // Set damage stat
    on("change:repeating_moves:move_cat", function(eventInfo){
        
        var statName="";
        
        if(eventInfo.newValue.toLowerCase() == "physical"){
            statName="attack_calc";
        }else if(eventInfo.newValue.toLowerCase() == "special"){
            statName="spattack_calc";
        }else{
            setAttrs({"repeating_moves_damage_stat":0});
            return;
        }
        
        getAttrs([statName],function(values){
            setAttrs({"repeating_moves_damage_stat":values[statName]});
        });
    });
    
    // Set HP MAx
    on("change:stat_hp_base change:stat_hp_allocated change:level change:isTrainer",function(eventInfo){
        
        getAttrs(["stat_hp_allocated", "stat_hp_base", "level","isTrainer"],function(values){
            
            var trainer = parseInt(values["isTrainer"])||0;
            var hp = (parseInt(values["stat_hp_base"])||0 ) + (parseInt(values["stat_hp_allocated"])||0 );
            var level = parseInt(values["level"])||0;
            var hp_m = 0;
            
            if(trainer == 0){
                //Pokemon Calc
                hp_m = (level) + (hp * 3) + 10;
            }
            if(trainer == 1){
                //Trainer Calc
                hp_m = (level * 2) + (hp * 3) + 10;
            }
            
            setAttrs({
                "HP_max": hp_m,
                "hp_mark_75":   Math.floor(hp_m*(3/4)),
                "hp_mark_50":   Math.floor(hp_m*(2/4)),
                "hp_mark_25":   Math.floor(hp_m*(1/4)),
                "hp_mark_1_3":  Math.floor(hp_m*(1/3)),
                "hp_mark_1_6":  Math.floor(hp_m*(1/6)),
                "hp_mark_1_8":  Math.floor(hp_m*(1/8)),
                "hp_mark_1_10": Math.floor(hp_m*(1/10)),
                "hp_mark_1_16": Math.floor(hp_m*(1/16))
            });
            
            
            
        });
        
    });
    
</script>
<script type="text/worker">

    //  HP Stat
    on( "change:stat_hp_base change:stat_hp_allocated", function(eventinfo){
        
        getAttrs(["stat_hp_base", "stat_hp_allocated"], function(values){
            
            var base = parseInt(values["stat_hp_base"],10)||0;
            var allocated = parseInt(values["stat_hp_allocated"],10)||0;
            
            var stat = (base + allocated);
            
            setAttrs({
                "stat_hp":stat
            });
            
        });
        
    });
    //  Attack
    on( "change:stat_atk_base change:stat_atk_allocated change:stat_atk_battle_stage", function(eventinfo){
        
        getAttrs(["stat_atk_base", "stat_atk_allocated", "stat_atk_battle_stage"],function(values){
            
            var base = parseInt(values["stat_atk_base"],10)||0;
            var allocated = parseInt(values["stat_atk_allocated"],10)||0;
            var battle = parseInt(values["stat_atk_battle_stage"],10)||0;
            
            var stat = (base + allocated) * (1 + (battle*0.1));
            
            setAttrs({
                "stat_atk":stat
            });
            
        });
        
    });
    //  Defense
    on( "change:stat_def_base change:stat_def_allocated change:stat_def_battle_stage change:evade_physical_bonus", function(eventinfo){
        
        getAttrs(["stat_def_base", "stat_def_allocated", "stat_def_battle_stage","evade_physical_bonus"],function(values){
            
            var base = parseInt(values["stat_def_base"],10)||0;
            var allocated = parseInt(values["stat_def_allocated"],10)||0;
            var battle = parseInt(values["stat_def_battle_stage"],10)||0;
            var evade = parseInt(values["evade_physical_bonus"],10)||0;
            
            var stat = (base + allocated) * (1 + (battle*0.1));
            
            evade=Math.floor(Math.max(0,Math.min(6, (stat/5) + evade  )));
            
            setAttrs({
                "stat_def":stat,
                "evade_physical":evade
            });
            
        });
        
    });
    //  Sp. Attack
    on( "change:stat_spatk_base change:stat_spatk_allocated change:stat_spatk_battle_stage", function(eventinfo){
        
        getAttrs(["stat_spatk_base", "stat_spatk_allocated", "stat_spatk_battle_stage"],function(values){
            
            var base = parseInt(values["stat_spatk_base"],10)||0;
            var allocated = parseInt(values["stat_spatk_allocated"],10)||0;
            var battle = parseInt(values["stat_spatk_battle_stage"],10)||0;
            
            var stat = (base + allocated) * (1 + (battle*0.1));
            
            setAttrs({
                "stat_spatk":stat
            });
            
        });
        
    });
    //  Sp. Defense
    on( "change:stat_spdef_base change:stat_spdef_allocated change:stat_spdef_battle_stage change:evade_special_bonus", function(eventinfo){
        
        getAttrs(["stat_spdef_base", "stat_spdef_allocated", "stat_spdef_battle_stage","evade_special_bonus"],function(values){
            
            var base = parseInt(values["stat_spdef_base"],10)||0;
            var allocated = parseInt(values["stat_spdef_allocated"],10)||0;
            var battle = parseInt(values["stat_spdef_battle_stage"],10)||0;
            var evade = parseInt(values["evade_special_bonus"],10)||0;
            
            var stat = (base + allocated) * (1 + (battle*0.1));
            
            evade=Math.floor(Math.max(0,Math.min(6, (stat/5) + evade  )));
            
            setAttrs({
                "stat_spdef":stat,
                "evade_special":evade
            });
            
        });
        
    });
    //  Speed
    on( "change:stat_speed_base change:stat_speed_allocated change:stat_speed_battle_stage change:evade_speed_bonus", function(eventinfo){
        
        getAttrs(["stat_speed_base", "stat_speed_allocated", "stat_spdef_battle_stage","evade_speed_bonus"],function(values){
            
            var base = parseInt(values["stat_speed_base"],10)||0;
            var allocated = parseInt(values["stat_speed_allocated"],10)||0;
            var battle = parseInt(values["stat_speed_battle_stage"],10)||0;
            var evade = parseInt(values["evade_speed_bonus"],10)||0;
            
            var stat = (base + allocated) * (1 + (battle*0.1));
            
            evade=Math.floor(Math.max(0,Math.min(6, (stat/5) + evade  )));
            
            setAttrs({
                "stat_speed":stat,
                "evade_speed":evade
            });
            
        });
        
    });
    
</script>
<script type="text/worker">
    // Overland, Swimming, Power, High Jump, Long Jump, Throw
    
    on("change:acrobatics change:athletics change:combat sheet:opened", function(eventinfo){
        
        getAttrs(["acrobatics","athletics","combat"],function(values){
            var acro = parseInt(values["acrobatics"], 10)||1;
            var athl = parseInt(values["athletics"], 10)||1;
            var com  = parseInt(values["combat"], 10)||1;
        
            var overland = 3 + Math.floor((athl+acro)/2);
            var swim     = Math.floor(overland/2);
            var power    = 4;
            var longJump = Math.floor(acro/2);
            var highJump = 0;
            var thrown   = 4 + athl;
            
            
            if(athl >= 3){power+= 1;}
            if(com >= 4){power+= 1;}
            
            if(acro >= 4){highJump+=1;}
            if(acro >= 5){highJump+=1;}
            
            setAttrs({
                "overland": overland,
                "swim": swim,
                "power": power,
                "longJump": longJump,
                "highJump": highJump,
                "throw_range": thrown
            });
        
        });
        
    });
    
</script>
<script type="text/worker">
    const stats = [
        'acrobatics','athletics','combat','intimidate','stealth','survival',
        'general_edu','medicine_edu','occult_edu','pokemon_edu','technology_edu','guile','perception',
        'charm','command','focus','intuition'
        ];
    stats.forEach(function (stat) {
        on("change:" + stat + " sheet:opened", function () {
            getAttrs([stat], function (values) {
                const stat_score = parseInt(values[stat], 10)||0;
                var stat_rank = "";

                switch(stat_score){
                    case 1:
                        stat_rank = "Pathetic";
                        break;
                    case 2:
                        stat_rank = "Untrained";
                        break;
                    case 3:
                        stat_rank = "Novice";
                        break;
                    case 4:
                        stat_rank = "Adept";
                        break;
                    case 5:
                        stat_rank = "Expert";
                        break;
                    case 6:
                        stat_rank = "Master";
                        break;
                    default:
                        stat_rank = "???";
                        break;
                }
                
                setAttrs({
                    [stat + '_rank']: stat_rank 
                });
            });
        });
    });
    
    
    on("change:repeating_skills:skill", function () {
            getAttrs(["repeating_skills_skill"], function (values) {
                const stat_score = parseInt(values["repeating_skills_skill"], 10)||0;
                var stat_rank = "";

                switch(stat_score){
                    case 1:
                        stat_rank = "Pathetic";
                        break;
                    case 2:
                        stat_rank = "Untrained";
                        break;
                    case 3:
                        stat_rank = "Novice";
                        break;
                    case 4:
                        stat_rank = "Adept";
                        break;
                    case 5:
                        stat_rank = "Expert";
                        break;
                    case 6:
                        stat_rank = "Master";
                        break;
                    default:
                        stat_rank = "???";
                        break;
                }
                
                setAttrs({
                    "repeating_skills_skill_rank": stat_rank 
                });
            });
        });
</script>
